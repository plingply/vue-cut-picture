!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.vueCutPicture=i()}(this,function(){"use strict";var t={template:'<div> <div class="cut_imgbox" ref="cut_imgbox" @touchend="carboxup($event)" @mouseup="carboxup($event)"> <div class="cut_left"> <div class="cut_box" ref="cut_box"> <img id="caijianimg" :src="imgurl" alt ref="caijianimg"> <div class="cut_catbox" ref="cut_carbox" @touchstart="carboxdown($event)" @touchend="carboxup($event)" @touchmove="carboxmove($event)" @mousedown="carboxdown($event)" @mouseup="carboxup($event)" @mousemove="carboxmove($event)"> <div class="cut_model cut_model1"></div> <div class="cut_model cut_model2"></div> <div class="cut_model cut_model3"></div> <div class="cut_model cut_model4"></div> <div class="cut_point cut_point1"></div> <div class="cut_point cut_point3"></div> <div class="cut_point cut_point5"></div> <div class="cut_point cut_point7"></div> </div> </div> </div> </div> <div ref="yulanimg" style="display:none"></div> <div class="cut_btn_box"> <button type="primary" @click="caijianimg">裁剪头像</button> </div> </div>',props:{height:{type:String,default:"200px"},width:{type:String,default:"100%"},cutwidth:{type:String,default:"200px"},cutheight:{type:String,default:"100px"},url:{required:!0}},data:function(){return{isClick:!1,isclick1:!1,point_className:"",oldx:0,oldy:0,imgurl:"",shx:1}},watch:{url:function(t){var i=new FileReader,e=this,s=this.$refs.cut_carbox.clientWidth;i.onload=function(){e.imgurl=this.result,e.$refs.caijianimg.style.maxWidth=e.width,e.$refs.caijianimg.style.minWidth=s+"px",e.$refs.caijianimg.style.maxHeight=e.height,setTimeout(function(){e.setCatboxposition()})},i.readAsDataURL(t)}},methods:{setBoxsize:function(){var t=this.$refs.cut_imgbox;t.style.width=this.width,t.style.height=this.height},savephoto:function(t){var i=this;this.$http.post("/api/users/setPortrait",{data:{portrait:t}}).then(function(t){"success"==t.msg&&i._alert({type:"success",msg:"保存成功"})})},savephoto1:function(t){var i=this;this.$http.post("/api/translator/setPortrait",{data:{pictureUrl:t}}).then(function(t){"success"==t.msg&&i._alert({type:"success",msg:"保存成功"})})},setCatboxposition:function(){var t=this.$refs.cut_box,i=this.$refs.cut_carbox,e=t.clientHeight,s=t.clientWidth;i.style.width=this.cutwidth,i.style.height=this.cutheight;var c=i.clientHeight,l=i.clientWidth,o=(s-l)/2<0?0:(s-l)/2,n=(e-c)/2<0?0:(e-c)/2;i.style.top=n+"px",i.style.left=o+"px",document.querySelectorAll(".cut_model").forEach(function(t){t.style.height=e+"px",-1!=t.className.indexOf("cut_model1")&&(t.style.width=s+"px",t.style.height=3*e+"px",t.style.left=-1*s+"px",t.style.top=-1*(3*e-c)/2+"px"),-1!=t.className.indexOf("cut_model2")&&(t.style.width="100%",t.style.left="0px",t.style.top=-1*e+"px"),-1!=t.className.indexOf("cut_model3")&&(t.style.width=s+"px",t.style.height=3*e+"px",t.style.left="100%",t.style.top=-1*(3*e-c)/2+"px"),-1!=t.className.indexOf("cut_model4")&&(t.style.left="0",t.style.width="100%",t.style.top="100%")}),i.style.opacity=1},carboxdown:function(t){t.preventDefault(),this.point_className=t.target.className,"cut_catbox"==t.target.className&&(this.isClick=!0,this.oldx=t.clientX?t.clientX:t.touches[0].clientX,this.oldy=t.clientY?t.clientY:t.touches[0].clientY),-1!=t.target.className.indexOf("cut_point")&&(this.oldx=t.clientX?t.clientX:t.touches[0].clientX,this.oldy=t.clientY?t.clientY:t.touches[0].clientY,this.isclick1=!0)},carboxup:function(){this.isClick=!1,this.isclick1=!1},carboxmove:function(t){var i=this.$refs.cut_box,e=this.$refs.cut_carbox,s=i.clientHeight,c=i.clientWidth,l=e.clientHeight,o=e.clientWidth;if(this.isClick){var n=t.clientX?t.clientX:t.touches[0].clientX,h=t.clientY?t.clientY:t.touches[0].clientY,a=n-this.oldx,d=h-this.oldy,u=parseFloat(e.style.left),r=parseFloat(e.style.top);(u+a>=0&&u+a<c-o||u+a<u&&u+a>=0)&&(e.style.left=u+a+"px",this.oldx=n),(r+d>=0&&r+d<s-l||r+d>=0&&r+d<r)&&(e.style.top=r+d+"px",this.oldy=h)}if(this.isclick1){n=t.clientX?t.clientX:t.touches[0].clientX,h=t.clientY?t.clientY:t.touches[0].clientY,this.oldx,this.oldy;var p=e.clientWidth;e.clientHeight,a=parseFloat(e.style.left),d=parseFloat(e.style.top);if(-1!=this.point_className.indexOf("cut_point1")){var x=p+(this.oldx-n);if((x>c||x/this.shx>s)&&x>p||x<50&&x<p)return;e.style.width=x+"px",e.style.height=x/this.shx+"px",e.style.left=a-(this.oldx-n)+"px",e.style.top=d-(this.oldx-n)/this.shx+"px",this.oldx=n,this.oldy=h}if(-1!=this.point_className.indexOf("cut_point3")){var f=p-(this.oldx-n);if((f>c||f/this.shx>s)&&f>p||f<50&&f<p)return;e.style.width=f+"px",e.style.height=f/this.shx+"px",e.style.top=d+(this.oldx-n)/this.shx+"px",this.oldx=n}if(-1!=this.point_className.indexOf("cut_point5")){var m=p-(this.oldx-n);if((m>c||m/this.shx>s)&&m>p||m<50&&m<p)return;e.style.width=p-(this.oldx-n)+"px",e.style.height=m/this.shx+"px",this.oldx=n}if(-1!=this.point_className.indexOf("cut_point7")){var y=p+(this.oldx-n);if((y>c||y/this.shx>s)&&y>p||y<50&&y<p)return;e.style.width=y+"px",e.style.height=y/this.shx+"px",e.style.left=a-(this.oldx-n)+"px",this.oldx=n}}},catImg:function(t,i,e,s){var c=document.createElement("canvas");c.id="cut_canvas",c.width=t,c.height=i,c.style.width=this.cutwidth,c.style.height=this.cutheight,this.$refs.yulanimg.innerHTML="",this.$refs.yulanimg.appendChild(c);var l=c.getContext("2d"),o=this.$refs.caijianimg;l.drawImage(o,-1*e,-1*s,2*o.width,2*o.height),this.upload()},caijianimg:function(){if(""!=this.imgurl){var t=this.$refs.cut_carbox,i=2*t.clientWidth,e=2*t.clientHeight,s=2*parseFloat(t.style.left),c=2*parseFloat(t.style.top);this.catImg(i,e,s,c)}else this._alert({type:"warning",msg:"请选择图片"})},upload:function(){var t=document.getElementById("caijianimg"),i=document.getElementById("cut_canvas");if(i){var e=t.src.substr(t.src.lastIndexOf(".")).substr(1),s=i.toDataURL(e);this.$emit("uploadfile",{file:function(t){for(var i=window.atob(t.split(",")[1]),e=new ArrayBuffer(i.length),s=new Uint8Array(e),c=0;c<i.length;c++)s[c]=i.charCodeAt(c);return new Blob([e],{type:"image/png"})}(s),src:s})}else this._alert({type:"warning",msg:"请先裁剪图片"})}},mounted:function(){this.setBoxsize();var t=this;this.shx=parseInt(this.cutwidth)/parseInt(this.cutheight),window.addEventListener("mouseup",function(){t.isClick=!1,t.isclick1=!1})},install:function(i,e){void 0===e&&(e="vueCutPicture"),i.component(e,t)}};return t});
